# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –±–∞–≥–∞ –∑ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è–º VIP —Å—Ç–∞—Ç—É—Å—É –∫–ª—ñ—î–Ω—Ç–æ–∫

## üêõ **–û–ü–ò–° –ü–†–û–ë–õ–ï–ú–ò**

–ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ VIP —Å—Ç–∞—Ç—É—Å—É –∫–ª—ñ—î–Ω—Ç–æ–∫, —è–∫—ñ –±—É–ª–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ —á–µ—Ä–µ–∑ —Å–µ—Å—ñ—ó (–∞ –Ω–µ —á–µ—Ä–µ–∑ –æ–∫—Ä–µ–º—É –∫–æ–ª–µ–∫—Ü—ñ—é clients), —Å—Ç–∞—Ç—É—Å –Ω–µ –∑–º—ñ–Ω—é–≤–∞–≤—Å—è –æ–¥—Ä–∞–∑—É. –ü–æ—Ç—Ä—ñ–±–Ω–æ –±—É–ª–æ —Å–ø–æ—á–∞—Ç–∫—É –∑–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è, –∑–±–µ—Ä–µ–≥—Ç–∏, —ñ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—ñ–º VIP —Å—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è.

### **–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏:**

1. **–ö–ª—ñ—î–Ω—Ç–∫–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ —á–µ—Ä–µ–∑ —Å–µ—Å—ñ—ó** –Ω–µ –º–∞–ª–∏ –∑–∞–ø–∏—Å—É –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó `clients`
2. **–ú–µ—Ç–æ–¥ `findClientId()`** –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏–≤ —Ç–∞–∫–∏—Ö –∫–ª—ñ—î–Ω—Ç–æ–∫  
3. **–ú–µ—Ç–æ–¥ `_updateClientSessionsData()`** –Ω–µ –∑–∞–≤–∂–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏–≤ —Å–µ—Å—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å `clientId`** –≤ —Å–µ—Å—ñ—è—Ö —É—Å–∫–ª–∞–¥–Ω—é–≤–∞–ª–∞ –ø–æ—à—É–∫ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

## ‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø**

### **1. –ü–æ–∫—Ä–∞—â–µ–Ω–æ –º–µ—Ç–æ–¥ `findClientId()`:**

#### **–î–û:**
```dart
Future<String?> findClientId(String name, String phone) async {
  final query = await _clientsCollection
      .where('name', isEqualTo: name)
      .where('phone', isEqualTo: phone)
      .get();
  
  if (query.docs.isNotEmpty) {
    return query.docs.first.id;
  }
  
  return null; // ‚ùå –ü–æ–≤–µ—Ä—Ç–∞–≤ null –¥–ª—è –∫–ª—ñ—î–Ω—Ç–æ–∫ –∑ —Å–µ—Å—ñ–π
}
```

#### **–ü–Ü–°–õ–Ø:**
```dart
Future<String?> findClientId(String name, String phone) async {
  // 1. –®—É–∫–∞—î–º–æ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó clients
  final query = await _clientsCollection
      .where('name', isEqualTo: name)
      .where('phone', isEqualTo: phone)
      .get();
  
  if (query.docs.isNotEmpty) {
    return query.docs.first.id;
  }
  
  // 2. ‚úÖ –Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —à—É–∫–∞—î–º–æ –≤ —Å–µ—Å—ñ—è—Ö —ñ –°–¢–í–û–†–Æ–Ñ–ú–û –∑–∞–ø–∏—Å
  final sessionsQuery = await _sessionsCollection
      .where('clientName', isEqualTo: name)
      .where('phone', isEqualTo: phone)
      .limit(1)
      .get();
  
  if (sessionsQuery.docs.isNotEmpty) {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–ª—ñ—î–Ω—Ç–∞ –∑ –¥–∞–Ω–∏–º–∏ –∑ —Å–µ—Å—ñ—ó
    final client = Client(name: name, phone: phone, isRegularClient: vip);
    final newClientRef = await _clientsCollection.add(client.toFirestore());
    
    // –û–Ω–æ–≤–ª—é—î–º–æ –≤—Å—ñ —Å–µ—Å—ñ—ó –∑ –Ω–æ–≤–∏–º clientId
    // ...
    
    return newClientRef.id;
  }
  
  return null;
}
```

### **2. –ü–æ–∫—Ä–∞—â–µ–Ω–æ –º–µ—Ç–æ–¥ `_updateClientSessionsData()`:**

#### **–î–û:**
```dart
Future<void> _updateClientSessionsData(...) async {
  // –ü—Ä–æ—Å—Ç–∏–π –ø–æ—à—É–∫ —è–∫–∏–π –º—ñ–≥ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Å—ñ—ó
  Query query = _sessionsCollection.where('clientId', isEqualTo: clientId);
  // ...
}
```

#### **–ü–Ü–°–õ–Ø:**
```dart
Future<void> _updateClientSessionsData(...) async {
  final Set<String> updatedDocIds = {}; // ‚úÖ –£–Ω–∏–∫–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
  
  // 1. –ü–†–Ü–û–†–ò–¢–ï–¢: –®—É–∫–∞—î–º–æ –∑–∞ —ñ–º'—è–º+—Ç–µ–ª–µ—Ñ–æ–Ω–æ–º (–¥–ª—è –∫–ª—ñ—î–Ω—Ç–æ–∫ –∑ —Å–µ—Å—ñ–π)
  if (oldName.isNotEmpty && oldPhone.isNotEmpty) {
    final namePhoneQuery = await _sessionsCollection
        .where('clientName', isEqualTo: oldName)
        .where('phone', isEqualTo: oldPhone)
        .get();
    
    for (final doc in namePhoneQuery.docs) {
      await doc.reference.update({
        'clientId': clientId, // ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ clientId
        'clientName': newName,
        'phone': newPhone,
        'isRegularClient': isRegularClient,
      });
      updatedDocIds.add(doc.id);
    }
  }
  
  // 2. –®—É–∫–∞—î–º–æ –∑–∞ clientId
  final clientIdQuery = await _sessionsCollection.where('clientId', isEqualTo: clientId).get();
  for (final doc in clientIdQuery.docs) {
    if (!updatedDocIds.contains(doc.id)) { // ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏
      // –û–Ω–æ–≤–ª—é—î–º–æ...
    }
  }
  
  // 3. ‚úÖ –î–û–î–ê–¢–ö–û–í–û: –®—É–∫–∞—î–º–æ —Å–µ—Å—ñ—ó –∑ –Ω–æ–≤–∏–º —ñ–º'—è–º –¥–ª—è VIP —Å—Ç–∞—Ç—É—Å—É
  if (oldName != newName && newName.isNotEmpty) {
    // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è VIP —Å—Ç–∞—Ç—É—Å—É
  }
}
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø**

### **–¢–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

1. **‚úÖ –ö–ª—ñ—î–Ω—Ç–∫–∏ –∑ —Å–µ—Å—ñ–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å –≤ `clients` –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ
2. **‚úÖ VIP —Å—Ç–∞—Ç—É—Å** - –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É, –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ñ–º'—è
3. **‚úÖ –ù–µ–º–∞—î –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Set –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–∏—Ö —Å–µ—Å—ñ–π
4. **‚úÖ –ü–æ–≤–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –≤—Å—ñ —Å–µ—Å—ñ—ó –∫–ª—ñ—î–Ω—Ç–∫–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Ä–∞–∑–æ–º
5. **‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è clientId** - –≤—Å—ñ —Å–µ—Å—ñ—ó –æ—Ç—Ä–∏–º—É—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π clientId –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –æ–Ω–æ–≤–ª–µ–Ω—å

### **–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**

–î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```
üîÑ –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ—Å—ñ—ó –∫–ª—ñ—î–Ω—Ç–∞: clientId=abc123, oldName="–ê–Ω–Ω–∞", newName="–ê–Ω–Ω–∞", VIP=true
üîç –®—É–∫–∞—î–º–æ —Å–µ—Å—ñ—ó –∑–∞ oldName="–ê–Ω–Ω–∞" —Ç–∞ oldPhone="+380501234567"
üìä –ó–Ω–∞–π–¥–µ–Ω–æ —Å–µ—Å—ñ–π –∑–∞ —ñ–º'—è–º+—Ç–µ–ª–µ—Ñ–æ–Ω–æ–º: 3
‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ —Å–µ—Å—ñ—é xyz789: "–ê–Ω–Ω–∞"->"–ê–Ω–Ω–∞", "+380501234567"->"+380501234567", VIP->true
üéâ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—Å—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–æ —Å–µ—Å—ñ–π: 3
```

### **–°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**

1. **–ö–ª—ñ—î–Ω—Ç–∫–∞ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó clients** - –ø—Ä–∞—Ü—é—î —è–∫ —Ä–∞–Ω—ñ—à–µ
2. **–ö–ª—ñ—î–Ω—Ç–∫–∞ —Ç—ñ–ª—å–∫–∏ –∑ —Å–µ—Å—ñ–π** - —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å –≤ clients, –ø–æ—Ç—ñ–º –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Å–µ—Å—ñ—ó
3. **–ó–º—ñ–Ω–∞ —Ç—ñ–ª—å–∫–∏ VIP —Å—Ç–∞—Ç—É—Å—É** - –ø—Ä–∞—Ü—é—î –æ–¥—Ä–∞–∑—É –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥—ñ–π
4. **–ó–º—ñ–Ω–∞ —ñ–º–µ–Ω—ñ + VIP —Å—Ç–∞—Ç—É—Å—É** - –≤—Å–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–∞–∑–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üöÄ **–¢–ï–°–¢–£–í–ê–ù–ù–Ø**

–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏:

1. ‚úÖ –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è VIP —Å—Ç–∞—Ç—É—Å—É –∫–ª—ñ—î–Ω—Ç–∫–∏ —Å—Ç–≤–æ—Ä–µ–Ω–æ—ó —á–µ—Ä–µ–∑ —Å–µ—Å—ñ—ó
2. ‚úÖ –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —ñ–º–µ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∫–∏  
3. ‚úÖ –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É –∫–ª—ñ—î–Ω—Ç–∫–∏
4. ‚úÖ –û–¥–Ω–æ—á–∞—Å–Ω–∞ –∑–º—ñ–Ω–∞ –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤
5. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ —Å–µ—Å—ñ—è–º–∏

**–ë–∞–≥ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ! VIP —Å—Ç–∞—Ç—É—Å —Ç–µ–ø–µ—Ä –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –∫–ª—ñ—î–Ω—Ç–æ–∫.** üéâ